# TRY Carry Trade Analysis Dashboard

Premium interactive dashboard for analyzing Turkish Lira carry trades with proper opportunity-cost baseline modeling.

## Model Overview

**Baseline = Opportunity Cost**

This model correctly treats the baseline as:
> "What USD I could have obtained on Day 0 at the EXECUTABLE bank rate, then earned USD risk-free (T-Bill) over the same horizon."

### Key Variables

| Variable | Formula | Description |
|----------|---------|-------------|
| `usd0_exec` | `principal_try / entry_bank_rate` | Executable USD at entry |
| `usd_rf_end` | `usd0_exec * (1 + rf * T)` | T-Bill end value |
| `spread` | `entry_bank_rate / spot_entry - 1` | Bank spread |
| `usd_end` | `final_try / bank_rate_end - swift` | Carry outcome |
| `excess_ret` | `usd_end / usd_rf_end - 1` | Excess return vs T-Bill |
| `bank_rate_be` | `final_try / (usd_rf_end + swift)` | Break-even bank rate |

### Break-even Logic

If maturity bank rate > `bank_rate_be`, the carry trade **underperforms** T-Bill.

---

## Installation

```bash
cd C:\Users\Lenovo\dashboard
pip install -r requirements.txt
```

---

## Running the Dashboard

### Option A: Streamlit Web App (Recommended)

```bash
cd C:\Users\Lenovo\dashboard
streamlit run app_streamlit.py
```

This opens a browser window at `http://localhost:8501` with:
- Interactive parameter sliders
- Real-time recalculation
- Scenario analysis charts
- Monte Carlo simulation
- Historical backtest
- Regime comparison
- Export to CSV

### Option B: Jupyter Notebook

**In VS Code:**
1. Open `notebook_dashboard.ipynb` in VS Code
2. Select Python kernel (top-right)
3. Run cells sequentially
4. Use widgets to adjust parameters

**In Jupyter Lab:**
```bash
cd C:\Users\Lenovo\dashboard
jupyter lab notebook_dashboard.ipynb
```

**In classic Jupyter:**
```bash
cd C:\Users\Lenovo\dashboard
jupyter notebook notebook_dashboard.ipynb
```

---

## File Structure

```
dashboard/
├── app_streamlit.py      # Streamlit web dashboard
├── notebook_dashboard.ipynb  # Jupyter notebook version
├── dashboard_core.py     # Core computation engine
├── data.py               # Data fetching & caching
├── plots.py              # Plotly visualizations
├── utils.py              # Formatting & validation
├── requirements.txt      # Dependencies
└── README.md             # This file
```

---

## Default Trade Parameters

| Parameter | Value | Description |
|-----------|-------|-------------|
| Principal | 1,430,000 TRY | Amount deposited |
| Deposit Rate | 39.5% annual | Bank interest rate |
| Term | 32 days | Calendar days |
| Stopaj | 17.5% | Withholding tax |
| Entry Spot | 42.72 | Mid-market USD/TRY |
| Entry Bank Rate | 43.10 | Executable TRY→USD rate |
| SWIFT Fee | $32.50 | Wire transfer cost |
| T-Bill Rate | 3.5% annual | US risk-free rate |

---

## Troubleshooting

### ipywidgets not showing in VS Code

1. Install the Jupyter extension
2. Run: `pip install ipywidgets`
3. Restart VS Code
4. If still not working, try:
   ```bash
   jupyter nbextension enable --py widgetsnbextension
   ```

### Plotly not rendering in Jupyter

1. Install nbformat: `pip install nbformat`
2. For VS Code, install "Jupyter" and "Plotly" extensions
3. Try setting renderer:
   ```python
   import plotly.io as pio
   pio.renderers.default = 'notebook'
   ```

### yfinance throttling/errors

The dashboard includes:
- 4-hour file cache (auto-enabled)
- Demo data fallback if API fails

To force refresh:
```python
from data import fetch_usdtry_data
df = fetch_usdtry_data(force_refresh=True)
```

### Streamlit port already in use

```bash
streamlit run app_streamlit.py --server.port 8502
```

---

## Verification

Run the consistency check to verify model correctness:

```python
from dashboard_core import run_consistency_check

checks = run_consistency_check()
print(checks['verification']['ALL_CHECKS_PASS'])  # Should be True
```

### Expected Values (with defaults)

| Metric | Expected Value |
|--------|----------------|
| `usd0_exec` | $33,178.65 |
| `usd_rf_end` | $33,280.52 |
| `spread` | 0.89% |
| `bank_rate_be` | ~44.12 |
| `spot_be` | ~43.73 |
| `be_move_pct` | +2.36% |

---

## Export Features

### Streamlit
- Download scenarios as CSV
- Download metrics as CSV
- Download full report as TXT

### Jupyter
Save charts to HTML:
```python
from plots import export_charts_to_html

figures = {'Chart Name': fig}
export_charts_to_html(figures, 'output.html')
```

---

## License

For educational and personal use.

---

## Author

Generated by Claude Opus 4.5 | 2026-01-09
